
:root {
    --bg-color: #050505; --panel-bg: #111; --text-color: #ccc;
    --font-main: 'Segoe UI', 'Microsoft JhengHei', sans-serif;
    --r-common: #b0b0b0; --r-rare: #55aaff; --r-epic: #aa55ff; --r-legend: #ffaa00; --r-heirloom: #e74c3c;
    --hp-color: #ff5555; --san-color: #55aaff; --gain: #4f4; --loss: #f44;
    --mbti-color: #00d9ff; --skill-color: #ffd700; --quest-color: #fa0;
    --moral-high: #4f4; --moral-low: #f44; --luck-color: #ffd700;
    --xp-color: #b5f;

/* === 戰鬥介面極度昇華版 === */

/* 1. 敵人面板：高科技戰術風格 */
#enemy-area {
    background: linear-gradient(180deg, #1a0505 0%, #000 100%);
    border-bottom: 2px solid #f44;
    padding: 15px;
    position: relative;
    overflow: hidden;

    flex-shrink: 0;   /* 禁止此區域被壓縮，這能確保它永遠保持完整高度 */
    z-index: 10;      /* 提高層級，確保它壓在日誌文字上方 */
    box-shadow: 0 5px 20px rgba(0, 0, 0, 0.9); /* 加深陰影，視覺上區隔開來 */
    min-height: 160px; /* 給予一個最小高度，避免被瞬間擠壓 */
}

/* 敵人頭像區 */
.enemy-visual {
    display: flex;
    justify-content: center;
    align-items: center;
    margin-bottom: 10px;
    height: 80px;
}
.enemy-avatar {
    font-size: 4em;
    filter: drop-shadow(0 0 10px rgba(255, 0, 0, 0.5));
    animation: float 3s ease-in-out infinite;
}

/* 敵人數據條 */
.enemy-hud {
    display: flex;
    flex-direction: column;
    gap: 5px;
}
.hud-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 0.9em;
}

/* 高級血條 */
.hp-bar-container {
    height: 16px;
    background: #300;
    border: 1px solid #600;
    border-radius: 8px;
    position: relative;
    overflow: hidden;
    box-shadow: inset 0 0 5px #000;
}
.hp-bar-fill {
    height: 100%;
    background: linear-gradient(90deg, #f22, #a00);
    width: 100%;
    transition: width 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
}
/* 血條光澤特效 */
.hp-bar-fill::after {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0; height: 50%;
    background: rgba(255,255,255,0.2);
}

/* 狀態圖標 */
.buff-row {
    display: flex;
    gap: 5px;
    flex-wrap: wrap;
    justify-content: center;
    margin-top: 8px;
}
.buff-badge {
    background: #222;
    border: 1px solid #444;
    padding: 2px 6px;
    font-size: 0.75em;
    border-radius: 4px;
    display: flex;
    align-items: center;
    gap: 3px;
}

/* 動畫特效 */
@keyframes float {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-10px); }
}
@keyframes shake {
    0% { transform: translate(1px, 1px) rotate(0deg); }
    10% { transform: translate(-1px, -2px) rotate(-1deg); }
    20% { transform: translate(-3px, 0px) rotate(1deg); }
    30% { transform: translate(3px, 2px) rotate(0deg); }
    40% { transform: translate(1px, -1px) rotate(1deg); }
    50% { transform: translate(-1px, 2px) rotate(-1deg); }
    60% { transform: translate(-3px, 1px) rotate(0deg); }
    70% { transform: translate(3px, 1px) rotate(-1deg); }
    80% { transform: translate(-1px, -1px) rotate(1deg); }
    90% { transform: translate(1px, 2px) rotate(0deg); }
    100% { transform: translate(1px, -2px) rotate(-1deg); }
}
.shaking { animation: shake 0.5s; }

.dmg-popup {
    position: absolute;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    color: #fff;
    font-weight: bold;
    font-size: 2em;
    text-shadow: 0 0 10px #f00;
    pointer-events: none;
    animation: popUp 0.8s forwards;
    z-index: 10;
}
@keyframes popUp {
    0% { opacity: 1; transform: translate(-50%, -50%) scale(0.5); }
    20% { transform: translate(-50%, -80%) scale(1.5); }
    100% { opacity: 0; transform: translate(-50%, -150%) scale(1); }
}

/* 戰鬥日誌優化 */
.log-combat-h { color: #aaa; border-left: 2px solid #555; padding-left: 8px; margin: 4px 0; font-size:0.9em; }
.log-combat-d { color: #f66; font-weight: bold; }
.log-combat-c { color: #fa0; font-weight: bold; font-size: 1.1em; text-shadow:0 0 5px #a50; }
.log-combat-p { color: #4f4; }

/* === 物品分類標籤樣式 === */
.type-tag {
    display: inline-block;
    font-size: 0.75em;
    padding: 1px 5px;
    border-radius: 3px;
    margin-right: 6px;
    font-weight: normal;
    vertical-align: middle;
    border: 1px solid #444;
    background: #222;
    color: #aaa;
}
/* 不同類型的微調顏色 (可選) */
.tag-melee { color: #f88; border-color: #633; }
.tag-ranged { color: #8f8; border-color: #363; }
.tag-def { color: #88f; border-color: #336; }
.tag-con { color: #fa0; border-color: #640; }
}
body { background-color: var(--bg-color); color: var(--text-color); font-family: var(--font-main); margin: 0; padding: 5px; display: flex; justify-content: center; height: 100vh; overflow: hidden; user-select: none; }
#game-container {
    width: 100%;
    max-width: 950px;
    display: flex;
    flex-direction: column; /* 垂直排列 */
    border: 1px solid #333;
    background: var(--panel-bg);
    box-shadow: 0 0 50px rgba(0,0,0,0.9);
    border-radius: 5px;
    position: relative;

    /* ★★★ 確保高度限制，讓內部滾動生效 ★★★ */
    height: 100vh;    /* 佔滿視窗高度 */
    max-height: 100vh;
    overflow: hidden; /* 禁止整個遊戲框出現滾動條 */
}

#header { padding: 8px; background: #181818; border-bottom: 1px solid #333; display: grid; grid-template-columns: repeat(6, 1fr); gap: 4px; font-size: 0.8em; text-align: center; }
#weather-bar { background: #080808; color: #ddd; padding: 4px 15px; text-align: center; font-size: 0.85em; border-bottom: 1px solid #333; display: flex; justify-content: space-between; align-items: center; }
.stat-box { cursor: pointer; padding: 2px; border-radius: 4px; background:#0f0f0f; border:1px solid #222; transition:0.2s; }
.stat-box:hover { background: #222; border-color: #666; }
.stat-val { font-weight: bold; font-size: 1.1em; color: #fff; display:block; }

#equip-bar { padding: 8px; background: #141414; border-bottom: 1px solid #333; display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; font-size: 0.8em; }
.eq-row { display: flex; flex-direction: column; justify-content: center; align-items: flex-start; background: #0a0a0a; padding: 6px 10px; border-radius: 4px; border: 1px solid #222; cursor: pointer; transition: 0.2s; min-height: 45px; position:relative; }
.eq-row:hover { border-color: #666; background: #1a1a1a; }
.eq-val { font-weight: bold; }
.mastery-tag { position: absolute; right: 5px; top: 5px; font-size: 0.7em; color: var(--skill-color); border: 1px solid var(--skill-color); padding: 1px 3px; border-radius: 3px; }

#log-area {
    /* ★★★ 新增/修改的關鍵屬性 ★★★ */
    flex-grow: 1;     /* 佔據剩餘空間 */
    flex-shrink: 1;   /* 空間不足時允許縮小 */
    min-height: 0;    /* Firefox/Chrome 的 Flexbox 滾動修復關鍵 */

    /* 原有樣式 */
    padding: 15px;
    overflow-y: auto; /* 讓文字在內部滾動 */
    background-color: #080808;
    font-family: 'Consolas', var(--font-main);
    border-bottom: 1px solid #333;
    line-height: 1.5;
    font-size: 0.9em;
    z-index: 1;       /* 層級低於敵人面板 */
}

.log-entry { margin-bottom: 5px; padding-bottom: 4px; border-bottom: 1px solid #1a1a1a; animation: fadeIn 0.2s; }
.c-gain { color: var(--gain); } .c-loss { color: var(--loss); } .c-epic { color: var(--r-epic); } .c-skill { color: var(--skill-color); font-weight:bold; } .c-quest { color: var(--quest-color); font-weight:bold; } .c-story { color: #f0f; font-weight:bold; }
.c-xp { color: var(--xp-color); font-weight: bold; }

#action-area { padding: 10px; background: #1a1a1a; display: flex; flex-direction: column; gap: 8px; min-height: 280px; }
.btn-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 8px; }
.combat-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; height:100%; }
.combat-full-width { grid-column: span 2; }

button { background: #252525; color: #ccc; border: 1px solid #444; padding: 10px; cursor: pointer; transition: 0.1s; border-radius: 4px; position: relative; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; }
button:hover { background: #333; border-color: #fff; color: #fff; transform: translateY(-1px); }
button:disabled { opacity: 0.3; cursor: not-allowed; transform: none; filter: grayscale(100%); }

.loc-btn { padding: 8px; min-height: 60px; border: 1px solid #333; background: #111; align-items: flex-start; text-align: left; width: 100%; }
.loc-name { font-weight: bold; font-size: 0.95em; color: #eee; margin-bottom: 4px; }
.loc-info { display: flex; justify-content: space-between; font-size: 0.75em; width: 100%; color: #888; }
.d-low { color:#4f4; } .d-mid { color:#fa0; } .d-high { color:#f44; } .d-dead { color:#d0f; font-weight:bold; }
.grid-3x3 { display: grid; grid-template-columns: repeat(3, 1fr); gap: 6px; height: 100%; flex-grow: 1; }

.overlay { position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.96); z-index: 99; display: flex; flex-direction: column; align-items: center; justify-content: center; }
#modal-content { background: #111; border: 1px solid #444; padding: 20px; max-width: 95%; width: 650px; border-radius: 8px; text-align: center; max-height: 90vh; overflow-y: auto; box-shadow: 0 0 30px #000; }

.comp-container { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px; text-align: left; }
.comp-box { background: #080808; border: 1px solid #333; padding: 10px; border-radius: 4px; }
.diff-up { color: #4f4; font-weight: bold; } .diff-down { color: #f44; font-weight: bold; } .diff-eq { color: #555; }

.story-text { margin-bottom: 15px; line-height: 1.8; color: #ddd; font-size: 1.05em; text-align: left; background: #161616; padding: 15px; border-radius: 5px; border-left: 3px solid var(--r-legend); }
.main-story-text { border-left-color: #f44; font-size: 1.1em; color: #fff; box-shadow: 0 0 10px rgba(255,0,0,0.1); }

.q0 { color: var(--r-common); } .q1 { color: var(--r-rare); text-shadow:0 0 5px rgba(85,170,255,0.3); } .q2 { color: var(--r-epic); text-shadow:0 0 8px rgba(170,85,255,0.5); font-weight:bold; } .q3 { color: var(--r-legend); text-shadow:0 0 10px rgba(255,170,0,0.6); font-weight:bold; border-bottom:1px dashed var(--r-legend); } 
.c-mbti { color: var(--mbti-color); font-weight: bold; }

#quest-btn { padding: 4px 10px; border: 1px solid var(--quest-color); color: var(--quest-color); background: #222; font-size: 0.9em; border-radius: 4px; cursor: pointer; transition:0.2s; }
#quest-btn:hover { background: #333; box-shadow: 0 0 10px var(--quest-color); }

.opt-btn { text-align: left; padding: 12px; border-left: 3px solid #555; }
.opt-btn:hover { border-left-color: #fff; background: #2a2a2a; }

@keyframes fadeIn { from { opacity:0; transform:translateY(5px); } to { opacity:1; transform:translateY(0); } }
::-webkit-scrollbar { width: 5px; } ::-webkit-scrollbar-thumb { background: #444; border-radius: 3px; }